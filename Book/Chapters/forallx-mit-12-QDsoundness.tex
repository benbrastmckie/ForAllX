%!TEX root = forallx-mit.tex
\chapter{The Soundness of QD}
  \label{ch.SoundQD}

In Ch~\ref{ch.SLsoundcomplete}, we showed that the tree method was sound and complete with respect to the semantics for SL.
In particular, soundness showed that whenever a tree with root $\Gamma\cup\set{\enot\metaA}$ closed, we could conclude that $\Gamma\cup\set{\enot\metaA}$ is unsatisfiable, and so $\Gamma \models \metaA$.
As a result, we could rely on the tree method to evaluate whether the premises of an argument entailed its conclusion.
The completeness result concerned the converse, showing that whenever some premises entail a conclusion, every tree that results from taking those premises together with the negation of the conclusion will close.
Accordingly, the tree method can always be relied upon to evaluate whether some premises entail their conclusion.

Although these are important results if we are to make use of the tree method, proof trees are of little independent interest.
Moreover, when it comes to extending the tree method to accommodate quantifiers, there is no guarantee that the tree will always complete.
This makes the tree method considerably less useful.
Additionally, proving soundness and completeness for the tree method does not tell us anything about our natural deduction systems SD or QD, and this is something we would like to understand.
Even if SD and QD do a good job of modelling natural reasoning in SL and QL$^=$ respectively, we should like to know whether the reasoning that we can conduct in the proof systems tells us anything about entailment and, subsequently, the validity of arguments.
Specifically, we should like to know the following: 
  $$\Gamma \proves_{\textsc{qd}} \metaA \text{ just in case } \Gamma \models \metaA.$$
Whereas the right-to-left direction is completeness, the left-to-right direction is soundness.
If QD were to fail to be sound, we would have little reason to care about QD for we could not rely on it to establish valid arguments.
Showing that QD is sound will be the focus of this chapter where it will follow as a result that SD is also sound.

As in the soundness proof for the tree method, the soundness proof for QD will go by induction on the length of proof.
In particular, we will be measuring proofs by how many lines they include.
If we can show that soundness holds for proofs of length $1$ and, moreover, that soundness holds for proofs of length $n+1$ if soundness holds for proofs of length $n$, we may conclude by induction that soundness holds for proofs of any length.
% This, of course, is no different from the statement of the soundness of QD.




\section{Soundness}%
  \label{sec:Soundness}

Assume $\Gamma \proves_{\textsc{qd}} \metaA$.
It follows that there is some proof in QD of $\metaA$ from the premises $\Gamma$ where we may call this proof $X$. 
Recall that we may evaluate which lines are live at any point in the course of a natural deduction proof in QD.
For ease of exposition, it will help to introduce some notation that we will use throughout.
In particular, we may take $\metaA_i$ to be the sentence on the $i$-th line of the proof $X$ and $\Gamma_i$ to include all and only the undischarged assumptions (including premises) at the $i$-th line in $X$.
We will then aim to show the following:
\begin{enumerate}[leftmargin=1.5in]
  \item[\it Base:] $\Gamma_1 \models \metaA_1$.
  \item[\it Induction:] $\Gamma_{n+1} \models \metaA_{n+1}$ if $\Gamma_k \models \metaA_k$ for every $k\leq n$.
\end{enumerate}
Given that we can establish these two claims, it follows by induction that $\Gamma_n \models \metaA_n$ for all $n$.
Since every proof is finite in length, there is a last line $m$ of the proof $X$ where $\Gamma_m=\Gamma$ is the set of premises and $\metaA_m=\metaA$ is the conclusion, and so $\Gamma \models \metaA$. 
Thus we may conclude:
  $$\text{If } \Gamma \proves_{\textsc{qd}} \metaA, \text{ then } \Gamma \models \metaA.$$
This establishes the soundness of QD over the semantics for QL$^=$.
It remains, however, to establish \textit{Base} and \textit{Induction} assumed above.

In order to prove \textit{Base}, we may recall from the definition of a proof in QD that $\metaA_1$ is either a premise, assumption, or follows by one of the proof rules for QD. 
Since $\metaA_1$ is the first line of the proof, the only proof rules that it could follow from are the assumption rule AS or identity introduction $=$I.
If $\metaA_1$ is an instance of $=$I, then $\Gamma_1=\varnothing$ and $\metaA_1$ is $\alpha=\alpha$ for some constant $\alpha$. 
Letting $\M=\tuple{\D,\I}$ be any model, it follows that $\I(\alpha)=\I(\alpha)$ where there is some variable assignment $\va{a}$.
Thus $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\alpha)$, and so $\VV{\I}{\va{a}}(\alpha=\alpha)=1$.
Since $\alpha=\alpha$ is a sentence, $\VV{\I}{}(\alpha=\alpha)=1$, and so $\M$ satisfies $\metaA_1$.
Generalising on $\M$, we may conclude that $\models \metaA_1$, and so equivalently $\Gamma_1 \models \metaA_1$.
If instead $\metaA_1$ is a premise or assumption, then $\Gamma_1=\set{\metaA_1}$ since $\metaA_1$ is not discharged in the first line.
As a result, $\Gamma_1 \models \metaA_1$ is immediate since any model $\M$ that satisfies $\Gamma_1$ also satisfies $\metaA_1$.
This is all that is required to establish \textit{Base}.

In order to establish \textit{Induction}, assume that $\Gamma_k \models \metaA_k$ for every $k\leq n$. 
It remains to show that $\Gamma_{n+1} \models \metaA_{n+1}$.
By the definition of a proof in QD, $\metaA_{n+1}$ is either a premise, assumption, or follows by one of the proof rules for QD. 
If $\metaA_{n+1}$ is a premise or assumption, then $\Gamma_{n+1} \models \metaA_{n+1}$ for the same reason given above.
If $\metaA_{n+1}$ is not not a premise or assumption, then $\metaA_{n+1}$ follows by one of the proof rules for QD. 
There are now twelve proof rules coming from SD along with six additional rules for the quantifiers and identity in QD.
Consider the following:
\begin{enumerate}[leftmargin=1.5in]
  \item[\it Rules:] If $\metaA_{n+1}$ follows by the proof rules for QD from sentences in $\Gamma_{n+1}$ and $\Gamma_k \models \metaA_k$ for every $k\leq n$, then $\Gamma_{n+1} \models \metaA_{n+1}$.
\end{enumerate}
Assuming \textit{Rules} for the time being, it follows that $\Gamma_{n+1} \models \metaA_{n+1}$, completing the proof of \textit{Induction}.
All that remains is to establish \textit{Rules} in the following sections.





\section{SD Rules}%
  \label{sec:SDRules}

We have already considered two rules in proving \textit{Base} by showing that AS and $=$I preserve entailment at least in the special case as $\Gamma_1 \models \metaA_1$.
More generally, we should like to show that all of the rules preserve entailment, and not just in the case of proofs with one line.
It is with this aim that we will seek to establish \textit{Rules} given above.

In order to divide the proof of \textit{Rules} into more manageable parts, this section will focus on the proof rules for SD. 
Accordingly, the proof begins with the assumption that $\metaA_{n+1}$ follows by the proof rules for SD from sentences in $\Gamma_{n+1}$ and that $\Gamma_k \models \metaA_k$ for every $k\leq n$.
We will then seek to show that $\Gamma_{n+1} \models \metaA_{n+1}$ where it will help to establish a number of supporting lemmas along the way.
This same strategy will latter be extended to show that $\Gamma_{n+1} \models \metaA_{n+1}$ when $\metaA_{n+1}$ follows from sentences in $\Gamma_{n+1}$ by the additional rules included in QD.
As a result, we will cover all of the rules in QD, thereby completing the proof of \textit{Rules}.






\subsection{Assumption and Reiteration}%
  \label{sub:AssumptionRule}

Before attending to the introduction and elimination rules for each of the logical operators included in SD, this section will focus on the assumption and reiteration rules.

\label{rule:AS}
\factoidbox{
  (AS) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by the assumption rule AS. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows by the assumption rule AS from the sentences in $\Gamma_{n+1}$.
  Since $\metaA_{n+1}$ is an undischarged assumption, it follows that $\metaA_{n+1}\in\Gamma_{n+1}$, and so any model that satisfies $\Gamma_{n+1}$ also satisfies $\metaA_{n+1}$. 
  Thus $\Gamma_{n+1} \models \metaA_{n+1}$.
\end{quote}

In order to establish the reiteration rule we will begin by proving the following lemmas which will play an important role in a number of proofs given below.

\begin{Lthm} \label{lemma:weak}
  If $\Gamma \models \metaA$ and $\Gamma \subseteq \Gamma'$, then $\Gamma' \models \metaA$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \models \metaA$ and $\Gamma \supseteq \Gamma'$.
  Letting $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma'$, it follows that $\VV{\I}{}(\metaB)=1$ for all $\metaB \in \Gamma'$.
  Since $\Gamma\subseteq \Gamma'$, it follows that $\VV{\I}{}(\metaB)=1$ for all $\metaB \in \Gamma$, and so $\M$ satisfies $\Gamma$. 
  By assumption, $\M$ satisfies $\metaA$, and so $\Gamma \models \metaA$.
\end{quote}



\begin{Lthm} \label{lemma:live}
  For any QD proof $X$, if $\metaA_k$ is live at line $n$ where $k\leq n$, then $\Gamma_k\subseteq \Gamma_{n}$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Let $X$ be a QD proof where $\metaA_k$ is live at line $n+1$ where $k\leq n$.
  Assume for contradiction that some undischarged assumption $\metaB \in \Gamma_k$ is not live at $n+1$.
  It follows that $\metaB$ has been discharged at a line $j>k$, and so $\metaA_k$ is dead at $n+1$, contradicting the above.
  Thus $\Gamma_k\subseteq \Gamma_{n+1}$ as desired.
\end{quote}

% TODO: add discussion of lemmas
Given the lemma above, we may now proceed to establish the reiteration rule R.

\label{rule:R}
\factoidbox{
  (R) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by the reiteration rule R. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows by the reiteration rule R from the sentences in $\Gamma_{n+1}$.
  It follows that $\metaA_{n+1}=\metaA_{k}$ for some $k\leq n$, and so $\Gamma_k \models \metaA_k$ by hypothesis.
  Since $\metaA_k$ is live at line $n+1$, we know by \textbf{\ref{lemma:live}} that $\Gamma_k\subseteq \Gamma_{n+1}$, and so $\Gamma_{n+1} \models \metaA_{k}$ by \bref{lemma:weak}.
  Thus $\Gamma_{n+1} \models \metaA_{n+1}$ given the identity above.
\end{quote}



\subsection{Negation Rules}%
  \label{sub:NegationRules}
  
\begin{Lthm} \label{lemma:unsat}
  If $\Gamma \models \metaA$ and $\Gamma \models \enot\metaA$, then $\Gamma$ is unsatisfiable.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \models \metaA$ and $\Gamma \models \enot\metaA$.
  Assume for contradiction that $\Gamma$ is satisfiable, and so there is some model $\M$ which satisfies $\Gamma$. 
  By assumption, $\M$ satisfies $\metaA$ and $\enot\metaA$, and so there is some variable assignment $\va{a}$ where $\VV{\I}{\va{a}}(\enot\metaA)=1$.
  By the semantics for negation, $\VV{\I}{\va{a}}(\metaA)\neq 1$ contradicting the above.
  Thus $\Gamma$ is unsatisfiable. 
\end{quote}




\begin{Lthm} \label{lemma:unsatent}
  If $\Gamma \cup \set{\metaA}$ is unsatisfiable, then $\Gamma \models \enot\metaA$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \cup \set{\metaA}$ is unsatisfiable and let $\M$ be any model that satisfies $\Gamma$. 
  If $\M$ satisfied $\metaA$, then $\M$ would satisfy $\Gamma \cup \set{\metaA}$ contrary to assumption, and so $\M$ does not satisfy $\metaA$.
  Thus $\VV{\I}{}(\metaA)\neq 1$, and so $\VV{\I}{\va{a}}(\metaA)\neq 1$ for all variable assignments $\va{a}$ over $\D$.
  It follows that $\VV{\I}{\va{a}}(\enot\metaA)= 1$ for some $\va{a}$ in particular, and so $\VV{\I}{}(\enot\metaA)= 1$.
  We may then conclude that $\M$ satisfies $\enot\metaA$, and so $\Gamma \models \enot\metaA$.
\end{quote}




\label{rule:NegI}
\factoidbox{
  ($\enot$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by negation introduction $\enot$I. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by negation introduction $\enot$I.
  Thus there is some subproof on lines $i$-$j$ where $i<j\leq n$ and $\metaA_{n+1}=\enot\metaA_i$, $\metaB=\metaA_h$, and $\enot\metaB=\metaA_k$ for $i\leq h\leq j$ and $i\leq k\leq j$.
  By parity of reasoning, we may assume that $h<k=j$.
  Thus we may represent the subproof as follows:

  \begin{proof}
  \open
    \hypo[i]{na}\metaA \as{for \enot I}
    \have[h]{b}\metaB
    \have[j]{nb}{\enot\metaB}
  \close
  \have[n+1]{a}[\ ]{\enot\metaA}\ni{na-nb} %note that UBC has a more complex citation convention: {na-b, na-nb}
  \end{proof}

  By hypothesis, $\Gamma_h \models \metaB$ and $\Gamma_j \models \enot\metaB$.
  With the exception of $\metaA_i=\metaA$, every assumption that is undischarged at lines $h$ and $j$ are also undischarged at line $n+1$.
  It follows that $\Gamma_h,\Gamma_j\subseteq\Gamma_{n+1}\cup\set{\metaA_i}$, and so $\Gamma_{n+1}\cup\set{\metaA_i} \models \metaB$ and $\Gamma_{n+1}\cup\set{\metaA_i} \models \enot\metaB$ by \textbf{\ref{lemma:weak}}.
  Thus $\Gamma_{n+1}\cup\set{\metaA_i}$ is unsatisfiable by \textbf{\ref{lemma:unsat}}, and so $\Gamma_{n+1} \models \enot\metaA_i$ by \textbf{\ref{lemma:unsatent}}.
  Equivalently, $\Gamma_{n+1} \models \metaA_{n+1}$.
\end{quote}





\label{rule:NegE}
\factoidbox{
  ($\enot$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by negation elimination $\enot$E. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by negation elimination $\enot$E.
  Thus there is some subproof on lines $i$-$j$ where $i<j\leq n$ and $\metaA_i=\enot\metaA_{n+1}$, $\metaB=\metaA_h$, and $\enot\metaB=\metaA_k$ for $i\leq h\leq j$ and $i\leq k\leq j$.
  By parity of reasoning, we may assume that $h<k=j$.
  Thus we may represent the subproof as follows:

  \begin{proof}
  \open
    \hypo[i]{na}{\enot\metaA} \as{for \enot E}
    \have[h]{b}{\metaB}
    \have[j]{nb}{\enot\metaB}
  \close
  \have[n+1]{a}[\ ]{\metaA}\ne{na-nb} %note that UBC has a more complex citation convention: {na-b, na-nb}
  \end{proof}

  By hypothesis, $\Gamma_h \models \metaB$ and $\Gamma_j \models \enot\metaB$.
  With the exception of $\metaA_i=\enot\metaA$, every assumption that is undischarged at lines $h$ and $j$ is also undischarged at line $n+1$.
  It follows that $\Gamma_h,\Gamma_j\subseteq\Gamma_{n+1}\cup\set{\metaA_i}$, and so $\Gamma_{n+1}\cup\set{\metaA_i} \models \metaB$ and $\Gamma_{n+1}\cup\set{\metaA_i} \models \enot\metaB$ by \textbf{\ref{lemma:weak}}.
  Thus $\Gamma_{n+1}\cup\set{\metaA_i}$ is unsatisfiable by \textbf{\ref{lemma:unsat}}, and so $\Gamma_{n+1} \models \enot\metaA_i$ by \textbf{\ref{lemma:unsatent}}.
  Equivalently, $\Gamma_{n+1} \models \enot\enot\metaA_{n+1}$.
  Letting $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma_{n+1}$, it follows that $\M$ satisfies $\enot\enot\metaA_{n+1}$, and so $\VV{\I}{\va{a}}(\enot\enot\metaA_{n+1})=1$ for some $\va{a}$. 
  By two applications of the semantics for negation, $\VV{\I}{\va{a}}(\metaA_{n+1})=1$, and so $\M$ satisfies $\metaA_{n+1}$
  Thus $\Gamma_{n+1} \models \metaA_{n+1}$ by generalising on $\M$.
\end{quote}




\subsection{Conjunction and Disjunction}%
  \label{sub:ConjunctionDisjunction}

\begin{Lthm} \label{lemma:assign}
  $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$ if $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} 
  The proof goes by induction on the complexity of $\metaA$.

  \textit{Base:} Assume $\comp(\metaA)=0$ and $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA$.
  It follows that $\metaA$ is either $\F^n\alpha_1,\ldots\alpha_n$ or $\alpha_1=\alpha_2$.
  Consider the following cases:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\F^n\alpha_1,\ldots,\alpha_n)=1 &\textit{ ~iff~ } \tuple{\VV{\I}{\va{a}}(\alpha_1),\ldots,\VV{\I}{\va{a}}(\alpha_n)}\in\I(\F^n)\\
      (\star) &\textit{ ~iff~ } \tuple{\VV{\I}{\va{c}}(\alpha_1),\ldots,\VV{\I}{\va{c}}(\alpha_n)}\in\I(\F^n)\\
      &\textit{ ~iff~ } \VV{\I}{\va{c}}(\F^n\alpha_1,\ldots,\alpha_n)=1.
  \end{align*}

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\alpha_1=\alpha_2)=1 &\textit{ ~iff~ } \VV{\I}{\va{a}}(\alpha_1) = \VV{\I}{\va{a}}(\alpha_2)\\
      (\ast) &\textit{ ~iff~ } \VV{\I}{\va{c}}(\alpha_1) = \VV{\I}{\va{c}}(\alpha_2)\\
      &\textit{ ~iff~ } \VV{\I}{\va{c}}(\alpha_1=\alpha_2)=1.
  \end{align*}

  If $\alpha_i$ is a constant, then $\VV{\I}{\va{a}}(\alpha_i)=\I(\alpha_i)=\VV{\I}{\va{c}}(\alpha_i)$, and if $\alpha_i$ is a variable, then $\VV{\I}{\va{a}}(\alpha_i)=\va{a}(\alpha_i)=\va{c}(\alpha_i)=\VV{\I}{\va{c}}(\alpha_i)$, thereby establishing $(\star)$ and $(\ast)$.
  Thus whenever $\comp(\metaA)=0$, if $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA$, then $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$.

  \textit{Induction:} Assume that whenever $\comp(\metaA)\leq n$, if $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA$, then $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$.  
  Letting $\comp(\metaA)=n+1$, assume that $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA$.
  There are seven cases to consider.

  \textit{Case 1:} Assume $\metaA=\enot\metaB$.
  Since $\comp(\metaA)=n+1$ and $\comp(\enot\metaB)=\comp(\metaB)+1$, it follows that $\comp(\metaB)\leq n$.
  It follows by hypothesis that $\VV{\I}{\va{a}}(\metaB)=\VV{\I}{\va{c}}(\metaB)$, and so $\VV{\I}{\va{a}}(\enot\metaB)=\VV{\I}{\va{c}}(\enot\metaB)$ by the semantics for negation.
  Thus $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$. 
  The cases for $\eand,\eor,\eif,$ and $\eiff$ are similar and so will be left as exercises.

  \textit{Case 6:} Assume $\metaA=\qt{\forall}{\gamma}\metaB$.
  For the same reasons given above, $\comp(\metaB)\leq n$.
  We may then consider the following biconditionals:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\qt{\forall}{\gamma}\metaB)=1 &\textit{ ~iff~ } \VV{\I}{\va{e}}(\metaB)=1 \text{ for all } \gamma\text{-variants } \va{e} \text{ of } \va{a}\\ 
      (\dagger) &\textit{ ~iff~ } \VV{\I}{\va{g}}(\metaB)=1 \text{ for all } \gamma\text{-variants } \va{g} \text{ of } \va{c}\\  
      &\textit{ ~iff~ } \VV{\I}{\va{c}}(\qt{\forall}{\gamma}\metaB)=1.
  \end{align*}

  In order to establish $(\dagger)$, assume that $\VV{\I}{\va{e}}(\metaB)=1$ for all $\gamma$-variants $\va{e}$ of $\va{a}$ and let $\va{g}$ be any $\gamma$-variant of $\va{c}$.
  Consider the $\gamma$-variant $\va{e}'$ of $\va{a}$ where $\va{e}'(\gamma)=\va{g}(\gamma)$.
  By assumption $\VV{\I}{\va{e}'}(\metaB)=1$, and by definition $\va{e}'(\alpha)=\va{a}(\alpha)$ for all $\alpha\neq\gamma$.

  Since $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA=\qt{\forall}{\gamma}\metaB$, it follows that $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha\neq\gamma$ in $\metaB$.
  Given the above, $\va{e}'(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha\neq\gamma$ in $\metaB$. 
  Moreover, $\va{g}$ is a $\gamma$-variant of $\va{c}$, and so $\va{g}(\alpha)=\va{c}(\alpha)$ for all $\alpha\neq\gamma$.
  Thus $\va{e}'(\alpha)=\va{g}(\alpha)$ for all free variables $\alpha\neq\gamma$ in $\metaB$. 

  Since $\va{e}'(\gamma)=\va{g}(\gamma)$ by definition, $\va{e}'(\alpha)=\va{g}(\alpha)$ for all free variables in $\metaB$.  
  By hypothesis, $\VV{\I}{\va{e}'}(\metaB)=\VV{\I}{\va{g}}(\metaB)$, and so $\VV{\I}{\va{g}}(\metaB)=1$.
  Generalising on $\va{g}$, it follows that $\VV{\I}{\va{g}}(\metaB)=1$ for all $\gamma$-variants $\va{g}$ of $\va{c}$.
  An analogous argument establishes the converse direction of $(\dagger)$.
  Thus we may conclude that $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$.

  The case for $\qt{\exists}{\gamma}$ is similar, and so will be left as exercise.
  It follows that whenever $\comp(\metaA)=n+1$, if $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables $\alpha$ in $\metaA$, then $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$.
  Thus the lemma follows by induction.
\end{quote}






\begin{Lthm} \label{lemma:allvar}
  $\VV{\I}{}(\metaA)= 1$ just in case $\VV{\I}{\va{a}}(\metaA)= 1$ for every v.a. $\va{a}$ over $\D$. 
\end{Lthm}
\begin{quote} 
  \textit{Proof:} 
       Assume that $\VV{\I}{}(\metaA)= 1$.
       Thus $\VV{\I}{\va{a}}(\metaA)= 1$ for some variable assignment $\va{c}$ over $\D$.
       Let $\va{a}$ be any variable assignment over $\D$.
       Since $\metaA$ has no free variables, vacuously $\va{a}(\alpha)=\va{c}(\alpha)$ for all free variables in $\metaA$, and so $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{c}}(\metaA)$ by \textbf{\ref{lemma:assign}}.
       Thus $\VV{\I}{\va{a}}(\metaA)=1$, and so generalising on $\va{a}$, it follows that $\VV{\I}{\va{a}}(\metaA)= 1$ for every variable assignment $\va{a}$ over $\D$.  

       Assume instead that $\VV{\I}{\va{a}}(\metaA)=1$ for every variable assignment $\va{a}$ over $\D$.
       Since $\D$ is nonempty, there is some variable assignment $\va{a}$ over $\D$, and so $\VV{\I}{\va{a}}(\metaA)=1$ follows from the assumption. 
       Thus we may conclude that $\VV{\I}{}(\metaA)=1$.
\end{quote}





  
\label{rule:ConI}
\factoidbox{
  ($\eand$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conjunction introduction $\eand$I. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conjunction introduction $\eand$I.
  Thus $\metaA_{n+1}=\metaA_i\eand\metaA_j$ for some lines $i,j\leq n$ that are live at line $n+1$.
  By hypothesis, $\Gamma_i\models \metaA_i$ and $\Gamma_j\models \metaA_j$ where $\Gamma_i,\Gamma_j\subseteq \Gamma_{n+1}$ by \textbf{\ref{lemma:live}}.
  Thus $\Gamma_{n+1} \models \metaA_i$ and $\Gamma_{n+1} \models \metaA_j$ by \textbf{\ref{lemma:weak}}.
  Letting $\M=\tuple{\D,\I}$ be a model which satisfies $\Gamma_{n+1}$, it follows that $\M$ also satisfies $\metaA_i$ and $\metaA_j$.
  By \textbf{\ref{lemma:allvar}}, $\VV{\I}{\va{a}}(\metaA_i)=\VV{\I}{\va{a}}(\metaA_j)=1$ for every variable assignment $\va{a}$ over $\D$, and so for some $\va{a}$ in particular.
  Thus $\VV{\I}{\va{a}}(\metaA_i\eand\metaA_j)=\VV{\I}{\va{a}}(\metaA_{n+1})=1$, and so $\M$ satisfies $\metaA_{n+1}$.
  By generalising on $\M$, we may conclude that $\Gamma_{n+1} \models \metaA_{n+1}$.
\end{quote}





\label{rule:ConE}
\factoidbox{
  ($\eand$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conjunction elimination $\eand$E. 
}

\begin{quote} 
  \textit{Proof:} Assuming $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conjunction elimination $\eand$E, there is some $i\leq n$ where either $\metaA_i=\metaA_{n+1}\eand\metaB$ or $\metaA_i=\metaB\eand\metaA_{n+1}$ is live at line $n+1$.
  % By parity of reasoning we may assume that $\metaA_i=\metaA_{n+1}\eand\metaB$.
  By hypothesis, $\Gamma_i\models \metaA_i$ where $\Gamma_i\subseteq \Gamma_{n+1}$ by \textbf{\ref{lemma:live}}.
  Thus $\Gamma_{n+1} \models \metaA_i$ by \textbf{\ref{lemma:weak}}, and so any model $\M=\tuple{\D,\I}$ which satisfies $\Gamma_{n+1}$ also satisfies $\metaA_i$, and so either satisfies $\metaA_{n+1}\eand\metaB$ or $\metaB\eand\metaA_{n+1}$.
  It follows that $\VV{\I}{\va{a}}(\metaA_{n+1}\eand\metaB)=1$ or $\VV{\I}{\va{a}}(\metaB\eand\metaA_{n+1})=1$, and so either way $\VV{\I}{\va{a}}(\metaA_{n+1})=1$ by the semantics for conjunction.
  Thus $\M$ satisfies $\metaA_{n+1}$, and so $\Gamma_{n+1} \models \metaA_{n+1}$ by generalising on $\M$.
\end{quote}




\label{rule:DisI}
\factoidbox{
  ($\eor$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by disjunction introduction $\eor$I. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by disjunction introduction $\eor$I.
  Thus $\metaA_{n+1}=\metaA_i\eor\metaB$ or $\metaA_{n+1}=\metaB\eor\metaA_i$ for some line $i\leq n$ that is live at line $n+1$.
  By hypothesis, $\Gamma_i\models \metaA_i$ where $\Gamma_i\subseteq \Gamma_{n+1}$ by \textbf{\ref{lemma:live}}, and so $\Gamma_{n+1} \models \metaA_i$ by \textbf{\ref{lemma:weak}}.
  Letting $\M=\tuple{\D,\I}$ be a model which satisfies $\Gamma_{n+1}$, it follows that $\M$ satisfies $\metaA_i$.
  Thus $\VV{\I}{\va{a}}(\metaA_i)=1$ for some variable assignment $\va{a}$.
  By the semantics for disjunction, both $\VV{\I}{\va{a}}(\metaA_{i}\eor\metaB)=1$ and $\VV{\I}{\va{a}}(\metaB\eor\metaA_{i})=1$, and so $\VV{\I}{\va{a}}(\metaA_{n+1})=1$.
  Thus $\M$ satisfies $\metaA_{n+1}$ where $\Gamma_{n+1} \models \metaA_{n+1}$ follows from generalising on $\M$.
\end{quote}




\label{rule:DisE}
\factoidbox{
  ($\eor$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by disjunction elimination $\eor$E. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by disjunction elimination $\eor$I.
  Thus there is some line $\metaA_i=\metaA_j\eor\metaA_k$ which is live at $n+1$ and subproofs on lines $j$-$h$ and $k$-$l$ where $i<j,k,h,l\leq n$ and $\metaA_h=\metaA_l=\metaA_{n+1}$.
  By parity of reasoning, we may assume that $h<k$, and so represent the proof as follows:

  \begin{proof}
  \have[i]{i}{\metaA\eor\metaB}
  \open
    \hypo[j]{j}{\metaA} \as{for $\eor$E}
    % \have[\vdots]{a}{}
    \have[h]{h}{\metaC}
  \close
  \open
    \hypo[k]{k}{\metaB} \as{for $\eor$E}
    % \have[\vdots]{b}{}
    \have[l]{l}{\metaC}
  \close
  \have[n+1]{a}[\ ]{\metaC}\oe{i,j-h,k-l} 
  \end{proof}

  By hypothesis, $\Gamma_i\models \metaA_i$, $\Gamma_h\models \metaA_h$, and $\Gamma_l\models \metaA_l$ where $\Gamma_i\subseteq \Gamma_{n+1}$ by \textbf{\ref{lemma:live}}, and so $\Gamma_{n+1} \models \metaA_i$ by \textbf{\ref{lemma:weak}}.
  With the exception of $\metaA_j=\metaA$, every assumption that is undischarged at line $h$ is also undischarged at line $n+1$, and so $\Gamma_h\subseteq\Gamma_{n+1}\cup\set{\metaA_j}$.
  Similarly, we may conclude that $\Gamma_l\subseteq\Gamma_{n+1}\cup\set{\metaA_k}$, and so $\Gamma_{n+1}\cup\set{\metaA_j} \models \metaA_h$ and $\Gamma_{n+1}\cup\set{\metaA_k} \models \metaA_l$ by \textbf{\ref{lemma:weak}}.

  Letting $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma_{n+1}$, it follows from above that $\M$ satisfies $\metaA_i$, and so $\VV{\I}{\va{a}}(\metaA_j\eor\metaA_k)=1$ for some variable assignment $\va{a}$ over $\D$.
  By the semantics for disjunction, either $\VV{\I}{\va{a}}(\metaA_j)=1$ or $\VV{\I}{\va{a}}(\metaA_k)=1$.
  If $\VV{\I}{\va{a}}(\metaA_j)=1$, then $\M$ satisfies $\Gamma_{n+1}\cup\set{\metaA_j}$, and so also satisfies $\metaA_h=\metaA_{n+1}$ given that $\Gamma_{n+1}\cup\set{\metaA_j} \models \metaA_h$. 
  If $\VV{\I}{\va{a}}(\metaA_k)=1$, then $\M$ satisfies $\Gamma_{n+1}\cup\set{\metaA_k}$, and so satisfies $\metaA_l=\metaA_{n+1}$ given that$\Gamma_{n+1}\cup\set{\metaA_k} \models \metaA_l$.
  It follows that either way, $\M$ satisfies $\metaA_{n+1}$, and so $\Gamma_{n+1} \models \metaA_{n+1}$ is the result of generalising on $\M$.
\end{quote}






\subsection{Conditional Rules}%
  \label{sub:ConditionalRules}
  
\begin{Lthm} \label{lemma:cond}
  If $\Gamma \cup \set{\metaA} \models \metaB$, then $\Gamma \models \metaA \supset \metaB$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \cup \set{\metaA} \models \metaB$ and let $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma$.
  Either $\M$ satisfies $\metaA$ or not, and so their are two cases to consider. 

  \textit{Case 1:}
  If $\M$ satisfies $\metaA$, then $\M$ satisfies $\Gamma \cup \set{\metaA}$.
  By assumption $\M$ satisfies $\metaB$, and so $\VV{\I}{\va{a}}(\metaB)=1$ for some variable assignment $\va{a}$ over $\D$.
  Thus $\VV{\I}{\va{a}}(\metaA \eif \metaB)=1$ by the semantics for the conditional, and so $\M$ satisfies $\metaA \supset \metaB$.

  \textit{Case 2:}
  If $\M$ does not satisfy $\metaA$, then $\VV{\I}{\va{a}}(\metaB)\neq 1$ for every variable assignment $\va{a}$ over $\D$. 
  By the semantics for the conditional, $\VV{\I}{\va{a}}(\metaA \eif \metaB)=1$ for all $\va{a}$, and so for some $\va{a}$ in particular.
  Thus $\M$ satisfies $\metaA \supset \metaB$.

  Since $\M$ satisfies $\metaA \supset \metaB$ in both cases, we may conclude that $\Gamma \models \metaA \supset \metaB$. 
\end{quote}






\label{rule:CondI}
\factoidbox{
  ($\eif$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conditional introduction $\eif$I. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conditional introduction $\eif$I.
  Thus there is some subproof on lines $i$-$j$ where $i<j\leq n$ and $\metaA_{n+1}=\metaA_i \eif \metaA_j$.
  We may represent the subproof as follows:

  \begin{proof}
  \open
    \hypo[i]{na}\metaA \as{for $\eif$I}
    \have[j]{nb}{\metaB}
  \close
  \have[n+1]{a}[\ ]{\metaA\eif\metaB}\ci{na-nb} %note that UBC has a more complex citation convention: {na-b, na-nb}
  \end{proof}

  By hypothesis, $\Gamma_j \models \metaA_j$.
  With the exception of $\metaA_i$, every assumption that is undischarged at line $j$ is also undischarged at line $n+1$.
  It follows that $\Gamma_j\subseteq\Gamma_{n+1}\cup\set{\metaA_i}$, and so $\Gamma_{n+1}\cup\set{\metaA_i} \models \metaA_j$ by \textbf{\ref{lemma:weak}}.
  Thus $\Gamma_{n+1} \models \metaA_i \eif \metaA_j$ by \textbf{\ref{lemma:cond}}.
  Equivalently, $\Gamma_{n+1} \models \metaA_{n+1}$.
\end{quote}





\label{rule:CondE}
\factoidbox{
  ($\eif$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conditional elimination $\eif$E. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conditional introduction $\eif$E.
  Thus there are some lines $\metaA_i=\metaA_j\eif\metaA_{n+1}$ and $\metaA_j$ for $i,j\leq n$ which are live at $n+1$, and so $\Gamma_i,\Gamma_j\subseteq\Gamma_{n+1}$ by \textbf{\ref{lemma:live}}.
  By hypothesis, $\Gamma_i\models \metaA_i$ and $\Gamma_j\models \metaA_j$, and so $\Gamma_{n+1} \models \metaA_i$ and $\Gamma_{n+1} \models \metaA_j$ by \textbf{\ref{lemma:weak}}.
  Letting $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma_{n+1}$, it follows that $\M$ satisfies $\metaA_i$ and $\metaA_j$.
  By \textbf{\ref{lemma:allvar}}, $\VV{\I}{\va{a}}(\metaA_i)=\VV{\I}{\va{a}}(\metaA_j\eif\metaA_{n+1})=\VV{\I}{\va{a}}(\metaA_j)=1$ for all variable assignment $\va{a}$ over $\D$, and so for some $\va{a}$ in particular.
  By the semantics for the conditional, either $\VV{\I}{\va{a}}(\metaA_j)\neq 1$ or $\VV{\I}{\va{a}}(\metaA_{n+1})=1$.
  Given the above, $\VV{\I}{\va{a}}(\metaA_{n+1})=1$, and so $\M$ satisfies $\metaA_{n+1}$.
  Generalising on $\M$, we may conclude that $\Gamma_{n+1} \models \metaA_{n+1}$.
\end{quote}






\label{rule:BiconI}
\factoidbox{
  ($\eiff$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conditional introduction $\eiff$I. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by biconditional introduction $\eiff$E.
  Thus there are some subproofs on lines $i$-$j$ and $h$-$k$ for some $i,j<h,k\leq n$ where $\metaA_i=\metaA_h=\metaA$, $\metaA_j=\metaA_k=\metaB$, and either $\metaA_{n+1}=\metaA\eiff\metaB$ or $\metaA_{n+1}=\metaB\eiff\metaA$.
  By parity of reasoning, we may assume that $\metaA_{n+1}=\metaA\eiff\metaB$.
  Thus we have:

  \begin{proof}
    \open
      \hypo[i]{i}{\metaA} \as{for $\eor$E}
      % \have[\vdots]{a}{}
      \have[j]{j}{\metaB}
    \close
    \open
      \hypo[h]{h}{\metaB} \as{for $\eor$E}
      % \have[\vdots]{b}{}
      \have[k]{k}{\metaA}
    \close
    \have[n+1]{a}[\ ]{\metaA \eiff \metaB}\bi{i-j,h-k} 
  \end{proof}

  By hypothesis, $\Gamma_j\models \metaA_j$, $\Gamma_k\models \metaA_k$, and $\Gamma_{n+1}\models \metaA_{n+1}$.
  With the exception of $\metaA_i$, every assumption that is undischarged at line $j$ is also undischarged at line $n+1$, and so $\Gamma_j\subseteq\Gamma_{n+1}\cup\set{\metaA_i}$.
  Similarly, we may conclude that $\Gamma_k\subseteq\Gamma_{n+1}\cup\set{\metaA_h}$, and so $\Gamma_{n+1}\cup\set{\metaA_i} \models \metaA_j$ and $\Gamma_{n+1}\cup\set{\metaA_h} \models \metaA_k$ by \textbf{\ref{lemma:weak}}.

  By \textbf{\ref{lemma:cond}}, both $\Gamma_{n+1} \models \metaA_i \eif \metaA_j$ and $\Gamma_{n+1} \models \metaA_h \eif \metaA_k$.
  Equivalently, $\Gamma_{n+1} \models \metaA \eif \metaB$ and $\Gamma_{n+1} \models \metaB \eif \metaA$.
  Letting $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma_{n+1}$, it follows that $\M$ satisfies $\metaA \eif \metaB$ and $\metaB \eif \metaA$ given the identities above.
  By \textbf{\ref{lemma:allvar}}, $\VV{\I}{\va{a}}(\metaA \eif \metaB)=\VV{\I}{\va{a}}(\metaB \eif \metaA)=1$ for all variable assignments $\va{a}$, and so for some $\va{a}$ in particular. 
  Thus $\VV{\I}{\va{a}}(\metaA)\neq 1$ or $\VV{\I}{\va{a}}(\metaB)=1$, and $\VV{\I}{\va{a}}(\metaB)\neq 1$ or $\VV{\I}{\va{a}}(\metaA)=1$ by the semantics for the conditional.
  As a result, $\VV{\I}{\va{a}}(\metaB)=1$ if $\VV{\I}{\va{a}}(\metaA)=1$, and similarly, $\VV{\I}{\va{a}}(\metaA)=1$ if $\VV{\I}{\va{a}}(\metaB)=1$, and so $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaB)$.
  Thus $\VV{\I}{\va{a}}(\metaA \eiff \metaB)=1$ by the semantics for the biconditional, and so $\M$ satisfies $\metaA_{n+1}$.
  Generalising on $\M$, we may conclude that $\Gamma_{n+1}\models\metaA_{n+1}$.
\end{quote}






\label{rule:BiconE}
\factoidbox{
  ($\eiff$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by conditional elimination $\eiff$E. 
}

\begin{quote} 
  \textit{Proof:} Assume $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by biconditional introduction $\eif$E.
Thus there are some lines $i,j\leq n$ that are live at $n+1$ where either $\metaA_i=\metaA_j\eiff\metaA_{n+1}$ or $\metaA_i=\metaA_{n+1}\eiff\metaA_j$.
  By parity of reasoning, we may assume that $\metaA_i=\metaA_j\eiff\metaA_{n+1}$ where $\Gamma_i,\Gamma_j\subseteq\Gamma_{n+1}$ follows by \textbf{\ref{lemma:live}}.
  By hypothesis, $\Gamma_i\models \metaA_i$ and $\Gamma_j\models \metaA_j$, and so $\Gamma_{n+1} \models \metaA_i$ and $\Gamma_{n+1} \models \metaA_j$ by \textbf{\ref{lemma:weak}}.
  Letting $\M=\tuple{\D,\I}$ be any model that satisfies $\Gamma_{n+1}$, it follows that $\M$ satisfies $\metaA_i$ and $\metaA_j$.
  By \textbf{\ref{lemma:allvar}}, $\VV{\I}{\va{a}}(\metaA_i)=\VV{\I}{\va{a}}(\metaA_j\eiff\metaA_{n+1})=\VV{\I}{\va{a}}(\metaA_j)=1$ for every variable assignment $\va{a}$ over $\D$, and so for some $\va{a}$ in particular. 
  By the semantics for the biconditional, $\VV{\I}{\va{a}}(\metaA_j)=\VV{\I}{\va{a}}(\metaA_{n+1})$, and so $\VV{\I}{\va{a}}(\metaA_{n+1})=1$.
  Thus $\M$ satisfies $\metaA_{n+1}$, and so we may conclude that $\Gamma_{n+1} \models \metaA_{n+1}$ by generalising on $\M$.
\end{quote}






\section{Substitution and Model Lemmas}% TODO move above
  \label{sec:Lemmas}



\begin{Lthm} \label{lemma:sub}
  $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})$ if $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$ and $\beta$ is free for $\alpha$ in $\metaA$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:}
  The proof goes by induction on the wff of QL$^=$. 

  \textit{Base:} Let $\metaA$ be a wff of QL$^=$ where $\comp(\metaA)=0$.
  Assume that $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$.
  It follows that $\metaA$ is either $\F^n\alpha_1,\ldots\alpha_n$ or $\alpha_1=\alpha_2$.
  If $\metaA$ is $\F^n\alpha_1,\ldots\alpha_n$ where $\gamma_i=\beta$ if $\alpha_i=\alpha$ and otherwise $\gamma_i=\alpha_i$, then we have:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\metaA)=1 &\textit{ ~iff~ } \VV{\I}{\va{a}}(\F^n\alpha_1,\ldots,\alpha_n)=1\\
      &\textit{ ~iff~ } \tuple{\VV{\I}{\va{a}}(\alpha_1),\ldots,\VV{\I}{\va{a}}(\alpha_n)}\in\I(\F^n)\\
      (\star) &\textit{ ~iff~ } \tuple{\VV{\I}{\va{a}}(\gamma_1),\ldots,\VV{\I}{\va{a}}(\gamma_n)}\in\I(\F^n)\\
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\F^n\gamma_1,\ldots,\gamma_n)=1\\
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})=1.
  \end{align*}

  Whenever $\alpha_i=\alpha$, it follows that $\VV{\I}{\va{a}}(\alpha_i)=\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$ by assumption.
  Since $\VV{\I}{\va{a}}(\beta)=\VV{\I}{\va{a}}(\gamma_i)$ by definition, we may conclude that $\VV{\I}{\va{a}}(\alpha_i)=\VV{\I}{\va{a}}(\gamma_i)$.
  If $\alpha_i\neq\alpha$, then $\alpha_i=\gamma_i$ by definition, and so $\VV{\I}{\va{a}}(\alpha_i)=\VV{\I}{\va{a}}(\gamma_i)$ is immediate.
  It follows that $\VV{\I}{\va{a}}(\alpha_i)=\VV{\I}{\va{a}}(\gamma_i)$ for all $1\leq i\leq n$, thereby justifying $(\star)$.
  The other biconditionals hold by definition or the semantics for atomic wffs of QL$^=$.

  If instead $\metaA$ is $\alpha_1=\alpha_2$, then assuming as before that $\gamma_i=\beta$ if $\alpha_i=\alpha$ and otherwise $\gamma_i=\alpha_i$, we have the following biconditionals:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\metaA)=1 &\textit{ ~iff~ } \VV{\I}{\va{a}}(\alpha_1=\alpha_2)=1\\
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\alpha_1)=\VV{\I}{\va{a}}(\alpha_n)\\
      (\ast) &\textit{ ~iff~ } \VV{\I}{\va{a}}(\gamma_1)=\VV{\I}{\va{a}}(\gamma_2)\\
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\gamma_1=\gamma_2)=1\\
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})=1.
  \end{align*}

  We may justify $(\ast)$ in an analogous manner to $(\star)$, where the justifications for the other biconditionals is the same as before. 
  It follows that $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})$ whenever $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$ and $\comp(\metaA)=0$. 

  \textit{Induction:} Assume that if $\comp(\metaA)\leq n$, then $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})$ whenever $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$. 
  Letting $\comp(\metaA)=n+1$, there are seven cases to consider corresponding to the operators $\enot,\eand,\eor,\eif,\eiff,\qt{\forall}{\gamma},$ and $\qt{\exists}{\gamma}$.

  \textit{Case 1:} Assume that $\metaA=\enot\metaB$ where $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$.
  Since $\comp(\metaA)=n+1$ and $\comp(\enot\metaB)=\comp(\metaB)+1$, it follows that $\comp(\metaB)\leq n$.
  It follows by hypothesis that $\VV{\I}{\va{a}}(\metaB)=\VV{\I}{\va{a}}(\metaB\unisub{\beta}{\alpha})$, and so $\VV{\I}{\va{a}}(\enot\metaB)=\VV{\I}{\va{a}}(\enot\metaB\unisub{\beta}{\alpha})$ by the semantics for negation.
  Thus $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})$ as desired. 
  % Since the cases for $\eand,\eor,\eif,$ and $\eiff$ are similar, these cases will be left as exercises for the reader.

  \textit{Case 6:} Assume $\metaA=\qt{\forall}{\gamma}\metaB$ where $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$.
  If $\gamma=\alpha$, if follows that $\alpha$ is not free in $\metaA$, and so $\metaA=\metaA\unisub{\beta}{\alpha}$.
  As a result, $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})$ is immediate.
  Assume instead that $\gamma\neq\alpha$ and consider the following biconditionals:
  % As before, $\comp(\metaB)\leq n$, and so $\VV{\I}{\va{c}}(\metaB)=\VV{\I}{\va{c}}(\metaB\unisub{\beta}{\alpha})$ whenever $\VV{\I}{\va{c}}(\alpha)=\VV{\I}{\va{c}}(\beta)$ by hypothesis.

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\metaA)=1 &\textit{ ~iff~ } \VV{\I}{\va{a}}(\qt{\forall}{\gamma}\metaB)=1\\
      &\textit{ ~iff~ } \VV{\I}{\va{e}}(\metaB)=1 \text{ for all } \gamma\text{-variants } \va{e} \text{ of } \va{a}\\ 
      (\dagger) &\textit{ ~iff~ } \VV{\I}{\va{e}}(\metaB\unisub{\beta}{\alpha})=1 \text{ for all } \gamma\text{-variants } \va{e} \text{ of } \va{a}\\  
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\qt{\forall}{\gamma}\metaB\unisub{\beta}{\alpha})=1\\ 
      &\textit{ ~iff~ } \VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})=1.
  \end{align*}

  Let $\va{e}$ be an arbitrary $\gamma$-variant of $\va{a}$.
  Since $\gamma\neq\alpha$, it follows that $\va{e}(\alpha)=\va{a}(\alpha)$ if $\alpha$ is a variable, and so $\VV{\I}{\va{e}}(\alpha)=\VV{\I}{\va{a}}(\alpha)$ regardless of whether $\alpha$ is a variable or a constant.
  Together with starting assumption $\VV{\I}{\va{e}}(\alpha)=\VV{\I}{\va{a}}(\beta)$.
  By assumption, $\beta$ is free for $\alpha$ in $\metaA$, and so $\gamma\neq\beta$.
  If $\beta$ is a variable, then $\va{e}(\beta)=\va{a}(\beta)$ since $\va{e}$ is a $\gamma$-variant of $\va{a}$, and so $\VV{\I}{\va{a}}(\beta)=\VV{\I}{\va{e}}(\beta)$ regardless of whether $\beta$ is a variable or a constant.
  Thus $\VV{\I}{\va{e}}(\alpha)=\VV{\I}{\va{e}}(\beta)$.
  As in \textit{Case 1}, $\comp(\metaB)\leq n$, and so $\VV{\I}{\va{e}}(\metaB)=\VV{\I}{\va{e}}(\metaB\unisub{\beta}{\alpha})$ by hypothesis.
  Since $\va{e}$ was any $\gamma$-variant of $\va{a}$, it follows that $\VV{\I}{\va{e}}(\metaB)=\VV{\I}{\va{e}}(\metaB\unisub{\beta}{\alpha})$ for all $\gamma$-variants $\va{e}$ of $\va{a}$, thereby establishing $(\dagger)$.
  The other biconditionals follow from the definitions and the semantics for the universal quantifier.

  Since the cases for $\eand,\eor,\eif,\eiff,$ and $\qt{\exists}{\gamma}$ are similar, these cases will be left as exercises for the reader.
  It follows that $\VV{\I}{\va{a}}(\metaA)=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})$ whenever $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$ and $\comp(\metaA)=n+1$.
  Thus the lemma follows by induction.
\end{quote}




\begin{Lthm} \label{lemma:model}
  If $\M=\tuple{\D,\I}$ and $\M'=\tuple{\D,\I'}$ share the domain $\D$ where $\I(\F^n)=\I'(\F^n)$ and $\I(\alpha)=\I'(\alpha)$ for every $n$-place predicate $\F^n$ and constant $\alpha$ that occurs in a wff $\metaA$, then $\VV{\I}{\va{a}}(\metaA)=\VV{\I'}{\va{a}}(\metaA)$ for any variable assignment $\va{a}$ over $\D$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume that $\M=\tuple{\D,\I}$ and $\M'=\tuple{\D,\I'}$ where $\I(\F^n)=\I'(\F^n)$ and $\I(\alpha)=\I'(\alpha)$ for every $n$-place predicate $\F^n$ and constant $\alpha$ that occurs in $\metaA$.
  The proof goes by induction on the complexity of $\metaA$.

  \textit{Base:} Assume $\comp(\metaA)=0$ where $\va{a}$ is any variable assignment over $\D$.
  It follows that $\metaA$ is either $\F^n\alpha_1,\ldots\alpha_n$ or $\alpha_1=\alpha_2$.
  Consider the following cases:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\F^n\alpha_1,\ldots,\alpha_n)=1 &\textit{ ~iff~ } \tuple{\VV{\I}{\va{a}}(\alpha_1),\ldots,\VV{\I}{\va{a}}(\alpha_n)}\in\I(\F^n)\\
      (\star) &\textit{ ~iff~ } \tuple{\VV{\I'}{\va{a}}(\alpha_1),\ldots,\VV{\I'}{\va{a}}(\alpha_n)}\in\I'(\F^n)\\
      &\textit{ ~iff~ } \VV{\I'}{\va{a}}(\F^n\alpha_1,\ldots,\alpha_n)=1.
  \end{align*}

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\alpha_1=\alpha_2)=1 &\textit{ ~iff~ } \VV{\I}{\va{a}}(\alpha_1) = \VV{\I}{\va{a}}(\alpha_2)\\
      (\ast) &\textit{ ~iff~ } \VV{\I'}{\va{a}}(\alpha_1) = \VV{\I'}{\va{a}}(\alpha_2)\\
      &\textit{ ~iff~ } \VV{\I'}{\va{a}}(\alpha_1=\alpha_2)=1.
  \end{align*}

  Whereas $\I(\F^n)=\I'(\F^n)$ is immediate from the assumption, we may observe that $\VV{\I}{\va{a}}(\alpha_i)=\I(\alpha_i)=\I'(\alpha_i)=\VV{\I'}{\va{a}}(\alpha_i)$ if $\alpha_i$ is a constant, and if $\alpha_i$ is a variable, then $\VV{\I}{\va{a}}(\alpha_i)=\va{a}(\alpha_i)=\VV{\I'}{\va{a}}(\alpha_i)$, thereby establishing $(\star)$ and $(\ast)$. 
  It follows that $\VV{\I}{\va{a}}(\metaA)=\VV{\I'}{\va{a}}(\metaA)$ for any variable assignment $\va{a}$ over $\D$ if $\comp(\metaA)=0$.

  \textit{Induction:} Assume that if $\comp(\metaA)\leq n$, then $\VV{\I}{\va{a}}(\metaA)=\VV{\I'}{\va{a}}(\metaA)$ for all variable assignments $\va{a}$ over $\D$. 
  Letting $\comp(\metaA)=n+1$, there are seven cases to consider corresponding to the operators $\enot,\eand,\eor,\eif,\eiff,\qt{\forall}{\gamma},$ and $\qt{\exists}{\gamma}$.

  \textit{Case 1:} Assume $\metaA=\enot\metaB$.
  Since $\comp(\metaA)=n+1$ and $\comp(\enot\metaB)=\comp(\metaB)+1$, it follows that $\comp(\metaB)\leq n$.
  By hypothesis, $\VV{\I}{\va{a}}(\metaB)=\VV{\I'}{\va{a}}(\metaB)$ for all variable assignments $\va{a}$ over $\D$, and so by the semantics for negation, $\VV{\I}{\va{a}}(\enot\metaB)=\VV{\I'}{\va{a}}(\enot\metaB)$ for all variable assignments $\va{a}$ over $\D$.
  Thus $\VV{\I}{\va{a}}(\metaA)=\VV{\I'}{\va{a}}(\metaA)$ for all variable assignments $\va{a}$ over $\D$ as desired. 
  The cases for $\eand,\eor,\eif,$ and $\eiff$ are similar.

  \textit{Case 6:} Assume $\metaA=\qt{\forall}{\gamma}\metaB$.
  For the same reasons given above, $\comp(\metaB)\leq n$.
  We may then consider the following biconditionals:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{\va{a}}(\qt{\forall}{\gamma}\metaB)=1 &\textit{ ~iff~ } \VV{\I}{\va{e}}(\metaB)=1 \text{ for all } \gamma\text{-variants } \va{e} \text{ of } \va{a}\\ 
      (\dagger) &\textit{ ~iff~ } \VV{\I'}{\va{e}}(\metaB)=1 \text{ for all } \gamma\text{-variants } \va{e} \text{ of } \va{a}\\  
      &\textit{ ~iff~ } \VV{\I'}{\va{a}}(\qt{\forall}{\gamma}\metaB)=1.
  \end{align*}

  By hypothesis, $\VV{\I}{\va{e}}(\metaB)=\VV{\I'}{\va{e}}(\metaB)$ for any variable assignment $\va{e}$, thereby establishing $(\dagger)$.
  The other biconditionals follow from the semantics for the universal quantifier.
  Thus $\VV{\I}{\va{a}}(\metaA)=\VV{\I'}{\va{a}}(\metaA)$ for all variable assignments $\va{a}$ over $\D$. 

  Since the cases for $\eand,\eor,\eif,\eiff,$ and $\qt{\exists}{\gamma}$ are similar to those above, they will be left as exercises for the reader.
  It follows that $\VV{\I}{\va{a}}(\metaA)=\VV{\I'}{\va{a}}(\metaA)$ for all variable assignments $\va{a}$ if $\comp(\metaA)=n+1$.
  Thus the lemma follows by induction.
\end{quote}






\section{QD Rules}%
  \label{sec:QDRules}

\subsection{Universal Quantifier Rules}%
  \label{sub:UniversalRules}
  

\begin{Lthm} \label{lemma:unigen}
  For any constant $\beta$ that does not occur in $\qt{\forall}{\alpha}\metaA$ or in any sentence $\metaC\in\Gamma$, if $\Gamma \models \metaA\unisub{\beta}{\alpha}$, then $\Gamma \models \qt{\forall}{\alpha}\metaA$. 
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \models \metaA\unisub{\beta}{\alpha}$ where $\beta$ is a constant that does not occur in $\forall\alpha\metaA$ or in any sentence $\metaC\in\Gamma$.
  Assume for contradiction that $\Gamma \nmodels \qt{\forall}{\alpha}\metaA$, and so there is some model $\M=\tuple{\D,\I}$ which satisfies $\Gamma$ but does not satisfy $\qt{\forall}{\alpha}\metaA$.
  Thus $\VV{\I}{}(\qt{\forall}{\alpha}\metaA)\neq 1$, and so $\VV{\I}{\va{a}}(\qt{\forall}{\alpha}\metaA)\neq 1$ for every variable assignment $\va{a}$, and so for some $\va{c}$ in particular. 
  By the semantics for the universal quantifier, $\VV{\I}{\va{c}}(\metaA)\neq 1$ for some $\alpha$-variant $\va{c}$ of $\va{a}$.
  Let $\M'$ be the same as $\M$ with the exception that $\I'(\beta)=\va{c}(\alpha)$.
  The following biconditionals hold for every $\metaB \in \Gamma$:

  \vspace{-.2in}
  \begin{align*}
    \VV{\I}{}(\metaB)=1 &\textit{ ~iff~ } \VV{\I}{\va{e}}(\metaB)=1 \text{ for some variable assignment } \va{e}\\
     (\star) &\textit{ ~iff~ } \VV{\I'}{\va{e}}(\metaB)=1 \text{ for some variable assignment } \va{e}\\ 
     &\textit{ ~iff~ } \VV{\I'}{}(\metaB)=1.
  \end{align*}

  By construction, $\M$ and $\M'$ have the same domain $\D$ where $\I(\F^n)=\I'(\F^n)$ and $\I(\alpha)=\I'(\alpha)$ for every $n$-place predicate $\F^n$ and every constant $\alpha\neq\beta$.
  Since $\beta$ does not occur in any $\metaB \in \Gamma$, the biconditional $(\star)$ follows from \textbf{\ref{lemma:model}}.
  Thus $\VV{\I}{}(\metaB)=\VV{\I'}{}(\metaB)$ for all $\metaB\in\Gamma$, and so $\M'$ satisfies $\Gamma$.
  By the assumption, $\M'$ satisfies $\metaA\unisub{\beta}{\alpha}$, and so $\VV{\I'}{}(\metaA\unisub{\beta}{\alpha})=1$.
  By \textbf{\ref{lemma:assign}}, $\VV{\I'}{\va{g}}(\metaA\unisub{\beta}{\alpha})=1$ for all variable assignments over $\D$, and so $\VV{\I'}{\va{c}}(\metaA\unisub{\beta}{\alpha})=1$ in particular.

  Recall $\VV{\I}{\va{c}}(\metaA)\neq 1$ from above.
  Since $\beta$ does not occur in $\qt{\forall}{\alpha}(\metaA)$, it follows that $\beta$ does not occur in $\metaA$, and so $\VV{\I'}{\va{c}}(\metaA)\neq 1$ follows by \textbf{\ref{lemma:model}}.
  However, since $\va{c}(\alpha)=\I'(\beta)$ where $\beta$ is a constant, $\VV{\I'}{\va{c}}(\alpha)=\VV{\I'}{\va{c}}(\beta)$ where $\beta$ is free for $\alpha$ in $\metaA$, and so $\VV{\I'}{\va{c}}(\metaA)=\VV{\I'}{\va{c}}(\metaA\unisub{\beta}{\alpha})$ follows from \textbf{\ref{lemma:sub}}.
  Thus $\VV{\I'}{\va{c}}(\metaA\unisub{\beta}{\alpha})\neq 1$, contradicting the above, and so we may conclude that $\Gamma \models \qt{\forall}{\alpha}\metaA$.
\end{quote}




\label{rule:UniI}
\factoidbox{
  ($\forall$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by universal introduction $\forall$I. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by universal introduction $\forall$I.
  Thus there is some $i\leq n$ where $\metaA_i=\metaA\unisub{\beta}{\alpha}$ is live at $n+1$ and $\beta$ does not occur in $\metaA_{n+1}=\qt{\forall}{\alpha}\metaA$ or in undischarged assumptions in $\Gamma_{n+1}$.
  By \textbf{\ref{lemma:live}}, $\Gamma_i\subseteq \Gamma_{n+1}$ where $\Gamma_i\models\metaA_i$ by hypotheses, and so $\Gamma_{n+1} \models \metaA_i$ by \textbf{\ref{lemma:weak}}.
  Equivalently, $\Gamma_{n+1} \models \metaA\unisub{\beta}{\alpha}$.
  Since $\beta$ does not occur in $\qt{\forall}{\alpha}\metaA$ or any undischarged assumptions in $\Gamma_{n+1}$, it follows by \textbf{\ref{lemma:unigen}} that $\Gamma_{n+1}\models \qt{\forall}{\alpha}\metaA$, and so $\Gamma_{n+1}\models\metaA_{n+1}$.
\end{quote}





\begin{Lthm} \label{lemma:uniinst}
  $\forall\alpha\metaA \models \metaA\unisub{\beta}{\alpha}$ where $\alpha$ is a variable and $\metaA\unisub{\beta}{\alpha}$ is a sentence. 
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Let $\M=\tuple{\D,\I}$ be any model that satisfies $\qt{\forall}{\alpha}\metaA$, and so $\VV{\I}{}(\qt{\forall}{\alpha}\metaA)=1$.
  Thus $\VV{\I}{\va{a}}(\qt{\forall}{\alpha}\metaA)=1$ for some $\va{a}$, and so $\VV{\I}{\va{c}}(\metaA)=1$ for every $\alpha$-variant $\va{c}$ of $\va{a}$ by the semantics for the universal quantifier.
  Letting $\va{c}$ be an $\alpha$-variant of $\va{a}$ where $\va{c}(\alpha)=\I(\beta)$, it follows that $\VV{\I}{\va{c}}(\alpha)=\VV{\I}{\va{c}}(\beta)$.
  Since there are no free variables in $\metaA\unisub{\beta}{\alpha}$, we know that $\beta$ is a constant, and so $\beta$ is free for $\alpha$ in $\metaA$.
  Thus $\VV{\I}{\va{c}}(\metaA)=\VV{\I}{\va{c}}(\metaA\unisub{\beta}{\alpha})$ follows by \textbf{\ref{lemma:sub}}, and so $\VV{\I}{}(\metaA\unisub{\beta}{\alpha})=1$ since $\metaA\unisub{\beta}{\alpha}$ is a sentence.
  As a result, $\M$ satisfies $\metaA\unisub{\beta}{\alpha}$, and so $\forall\alpha\metaA \models \metaA\unisub{\beta}{\alpha}$.
\end{quote}






\begin{Lthm} \label{lemma:cut}
  If $\Gamma \models \metaA$ and $\Sigma \cup \set{\metaA} \models \metaB$, then $\Gamma\cup\Sigma \models \metaB$. 
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \models \metaA$ and $\Sigma \cup \set{\metaA} \models \metaB$.
  Let $\M$ be any model that satisfies $\Gamma\cup\Sigma$.
  It follows that $\M$ satisfies $\Gamma$, and so $\M$ satisfies $\metaA$.
  Thus $\M$ satisfies $\Gamma\cup\Sigma$, and so $\M$ satisfies $\metaB$.
  Generalising on $\M$, we may conclude that $\Gamma\cup\Sigma\models\metaB$.
\end{quote}






\label{rule:UniE}
\factoidbox{
  ($\forall$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by universal elimination $\forall$E. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by universal elimination $\forall$E.
  Thus there is some $i\leq n$ where $\metaA_i=\qt{\forall}{\alpha}\metaA$ is live at $n+1$ and $\metaA_{n+1}=\metaA\unisub{\beta}{\alpha}$ for some variable $\alpha$ and constant $\beta$.
  By \textbf{\ref{lemma:live}}, $\Gamma_i\subseteq \Gamma_{n+1}$ where $\Gamma_i\models\metaA_i$ by hypotheses, and so $\Gamma_{n+1} \models \metaA_i$ by \textbf{\ref{lemma:weak}}.
  Equivalently, $\Gamma_{n+1} \models \qt{\forall}{\alpha}\metaA$.
  By \textbf{\ref{lemma:uniinst}} that $\qt{\forall}{\alpha}\metaA\models \metaA\unisub{\beta}{\alpha}$, and so $\Gamma_{n+1}\models\metaA_{n+1}$ by \textbf{\ref{lemma:cut}}.
\end{quote}






\subsection{Existential Quantifier Rules}%
  \label{sub:ExistentialRules}
 
\begin{Lthm} \label{lemma:exigen}
  $\metaA\unisub{\beta}{\alpha} \models \exists\alpha\metaA$ where $\alpha$ is a variable and $\metaA\unisub{\beta}{\alpha}$ is a sentence. 
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Let $\M=\tuple{\D,\I}$ be any model that satisfies $\metaA\unisub{\beta}{\alpha}$.
  Thus $\VV{\I}{}(\metaA\unisub{\beta}{\alpha})=1$, and so $\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\alpha})=1$ for some $\va{a}$.
  Let $\va{c}$ be an $\alpha$-variant of $\va{a}$ where $\va{c}(\alpha)=\I(\beta)$.
  It follows that $\VV{\I}{\va{c}}(\alpha)=\VV{\I}{\va{c}}(\beta)$ where $\beta$ is free for $\alpha$ in $\metaA$, and so $\VV{\I}{\va{c}}(\metaA\unisub{\beta}{\alpha})=\VV{\I}{\va{c}}(\metaA)$ by \textbf{\ref{lemma:sub}}.
  By the semantics for the existential quantifier, $\VV{\I}{\va{a}}(\qt{\exists}{\alpha}\metaA)=1$.
  Since $\metaA\unisub{\beta}{\alpha}$ is a sentence, at most $\alpha$ is free in $\metaA$, and so $\qt{\exists}{\alpha}\metaA$ is a sentence. 
  Hence $\VV{\I}{}(\qt{\exists}{\alpha}\metaA)=1$, and so $\M$ satisfies $\qt{\exists}{\alpha}\metaA$.
  Thus $\metaA\unisub{\beta}{\alpha} \models \exists\alpha\metaA$.
\end{quote}





\label{rule:ExistI}
\factoidbox{
  ($\exists$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by existential introduction $\exists$I. 
}

\begin{quote} 
  \textit{Proof:} Assume that $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by existential introduction $\exists$E.
  Thus there is some $i\leq n$ where $\metaA_i=\metaA\unisub{\beta}{\alpha}$ is live at $n+1$ and $\metaA_{n+1}=\qt{\exists}{\alpha}\metaA$ for some variable $\alpha$ and constant $\beta$.
  By \textbf{\ref{lemma:live}}, $\Gamma_i\subseteq \Gamma_{n+1}$ where $\Gamma_i\models\metaA_i$ by hypotheses, and so $\Gamma_{n+1} \models \metaA_i$ by \textbf{\ref{lemma:weak}}.
  Equivalently, $\Gamma_{n+1} \models \metaA\unisub{\beta}{\alpha}$.
  Since $\metaA\unisub{\beta}{\alpha} \models \qt{\exists}{\alpha}\metaA$ by \textbf{\ref{lemma:exigen}}, $\Gamma_{n+1}\models\metaA_{n+1}$ follows from \textbf{\ref{lemma:cut}}.
\end{quote}





\begin{Lthm} \label{lemma:exiinst}
  For any constant $\beta$ that does not occur in $\exists\alpha\metaA$, $\metaB$, or in any sentence $\metaC\in\Gamma$, if $\Gamma \models \exists\alpha\metaA$ and $\Gamma \cup \set{\metaA\unisub{\beta}{\alpha}} \models \metaB$, then $\Gamma \models \metaB$.
\end{Lthm}
% \vspace{-.3in}

\begin{quote} 
  \textit{Proof:} Assume $\Gamma \models \exists\alpha\metaA$ and $\Gamma \cup \set{\metaA\unisub{\beta}{\alpha}} \models \metaB$ where $\beta$ is a constant that does not occur in $\exists\alpha\metaA$, $\metaB$, or in any sentence $\metaC\in\Gamma$. 
  Let $\M=\tuple{\D,\I}$ be a model that satisfies $\Gamma$.
  It follows that $\M$ satisfies $\qt{\exists}{\alpha}\metaA$, and so $\VV{\I}{\va{a}}(\qt{\exists}{\alpha}\metaA)=1$ for some variable assignment $\va{a}$ over $\D$.
  Thus $\VV{\I}{\va{c}}(\metaA)=1$ for some $\alpha$-variant $\va{c}$ of $\va{a}$.

  Let $\M'$ be the same as $\M$ with the only exception being that $\I'(\beta)=\va{c}(\alpha)$.
  Given the assumptions about $\beta$, it follows by similar reasoning to the previous lemma that $\M'$ satisfies $\Gamma$.
  Additionally, since $\beta$ does not occur in $\qt{\exists}{\alpha}\metaA$, it follows that $\beta$ does not occur in $\metaA$, and so $\VV{\I}{\va{c}}(\metaA)=\VV{\I'}{\va{c}}(\metaA)$ by \textbf{\ref{lemma:model}}.
  Moreover, $\VV{\I'}{\va{c}}(\beta)=\VV{\I'}{\va{c}}(\alpha)$ where $\beta$ is free for $\alpha$ in $\metaA$ on account of being a constant, and so $\VV{\I'}{\va{c}}(\metaA)=\VV{\I'}{\va{c}}(\metaA\unisub{\beta}{\alpha})$ by \textbf{\ref{lemma:sub}}. 
  Given the identities above, we may conclude that $\VV{\I'}{\va{c}}(\metaA\unisub{\beta}{\alpha})=1$, and so $\VV{\I'}{}(\metaA\unisub{\beta}{\alpha})=1$ since $\metaA\unisub{\beta}{\alpha}$ is a sentence.
  Thus $\M'$ satisfies $\Gamma \cup \set{\metaA\unisub{\beta}{\alpha}}$, and so by the assumption above, $\M'$ also satisfies $\metaB$.
  By definition $\VV{\I'}{\va{e}}(\metaB)=1$ for some variable assignment $\va{e}$ over $\D$, and since $\beta$ does not occur in $\metaB$, we may conclude by \textbf{\ref{lemma:model}} that $\VV{\I}{\va{e}}(\metaB)=1$.
  Thus $\M$ satisfies $\metaB$, and so by generalising on $\M$ it follows that $\Gamma \models \metaB$.
\end{quote}






\label{rule:ExistE}
\factoidbox{
  ($\exists$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by existential elimination $\exists$E. 
}

\begin{quote} 
  \textit{Proof:} % TODO: continue
\end{quote}







\subsection{Identity Rules}%
  \label{sub:IdentityRules}
  


\label{box:Lemma13}
\factoidbox{
  \textbf{Lemma \ref{ch.SoundQD}.13}: If $\alpha$ and $\beta$ are constants, then $\metaA\unisub{\alpha}{\gamma}, \alpha = \beta \models \metaA\unisub{\beta}{\gamma}$.
  }

\begin{quote} 
  \textit{Proof:} Let $\M=\tuple{\D,\I}$ be a model that satisfies $\metaA\unisub{\alpha}{\gamma}$ and $\alpha = \beta$ where $\alpha$ and $\beta$ are constants. 
  It follows that $\VV{\I}{\va{a}}(\metaA\unisub{\alpha}{\gamma})=1$ for some variable assignment $\va{a}$ over $\D$.
  By \textbf{\ref{lemma:allvar}}, $\VV{\I}{\va{c}}(\alpha=\beta)=1$ for all variable assignments $\va{c}$ over $\D$, and so $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$ in particular.
  Thus $\VV{\I}{\va{a}}(\alpha)=\VV{\I}{\va{a}}(\beta)$.
  Since $\beta$ is a constant, $\beta$ is free for $\alpha$ in $\metaA\unisub{\alpha}{\gamma}$, and so $\VV{\I}{\va{a}}(\metaA\unisub{\alpha}{\gamma})=\VV{\I}{\va{a}}((\metaA\unisub{\alpha}{\gamma})\unisub{\beta}{\alpha})$ by \textbf{\ref{lemma:sub}}.
  However, $(\metaA\unisub{\alpha}{\gamma})\unisub{\beta}{\alpha}=\metaA\unisub{\beta}{\gamma}$, and so $\VV{\I}{\va{a}}(\metaA\unisub{\alpha}{\gamma})=\VV{\I}{\va{a}}(\metaA\unisub{\beta}{\gamma})=1$.
  Since $\metaA\unisub{\beta}{\gamma}$ is a sentence, $\VV{\I}{}(\metaA\unisub{\beta}{\gamma})=1$, and so $\M$ satisfies $\metaA\unisub{\beta}{\gamma}$. 
  Generalising on $\M$ we may conclude that $\metaA\unisub{\alpha}{\gamma}, \alpha = \beta \models \metaA\unisub{\beta}{\gamma}$. 
\end{quote}







\label{rule:IdI}
\factoidbox{
  ($=$I) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by identity introduction $=$I. 
}




\label{rule:IdE}
\factoidbox{
  ($=$E) $\Gamma_{n+1} \models \metaA_{n+1}$ if $\metaA_{n+1}$ follows from $\Gamma_{n+1}$ by identity elimination $=$E. 
}








\section{Conclusion}%
  \label{sec:Conclusion}
  
% TODO: thus we can trust our natural deduction system

% TODO: entails that SD is also sound


\iffalse

\practiceproblems

\solutions
\problempart
\label{pr.QL.trees.tautology}
Use a tree to test whether the following sentences are tautologies. If they are not tautologies, describe a model on which they are false.
\begin{earg}
\item $\qt{\forall}{x} \qt{\forall}{y} (Gxy \eif \qt{\exists}{z} Gxz)$
\item $\qt{\forall}{x} Fx \eor \qt{\forall}{x} (Fx \eif Gx)$
\item $\qt{\forall}{x} (Fx \eif (\enot Fx \eif \qt{\forall}{y} Gy))$
\item $\qt{\exists}{x} (Fx \eor \enot Fx)$
\item $\qt{\exists}{x} Jx \eiff \enot \qt{\forall}{x} \enot Jx$
\item $\qt{\forall}{x} (Fx \eor Gx) \eif (\qt{\forall}{y} Fy \eor \qt{\exists}{x} Gx)$
\end{earg}

\solutions
\problempart
\label{pr.QL.trees.validity}
Use a tree to test whether the following argument forms are valid. If they are not, give a model as a counterexample.
\begin{earg}
\item $Fa$, $Ga$, \therefore\ $\qt{\forall}{x} (Fx \eif Gx)$
\item $Fa$, $Ga$, \therefore\ $\qt{\exists}{x} (Fx \eand Gx)$
\item $\qt{\forall}{x} \qt{\exists}{y} Lxy$, \therefore\ $\qt{\exists}{x} \qt{\forall}{y} Lxy$
\item $\qt{\exists}{x} (Fx \eand Gx)$, $Fb \eiff Fa$, $Fc \eif Fa$, \therefore\ $Fa$
\item $\qt{\forall}{x} \qt{\exists}{y} Gyx$, \therefore\ $\qt{\forall}{x} \qt{\exists}{y} (Gxy \eor Gyx)$
\end{earg}

\problempart
\label{pr.QL.trees.translation.and.validity}
Translate each argument into QL, specifying a UD, then use a tree to evaluate the resulting form for validity. If it is invalid, give a model as a counterexample.
\begin{earg}
\item Every logic student is studying. Deborah is not studying. Therefore, Deborah is not a logic student.
\item Kirk is a white male Captain. Therefore, some Captains are white.
\item The Red Sox are going to win the game. Every team who wins the game will be celebrated. Therefore, the Red Sox will be celebrated.
\item The Red Sox are going to win the game. Therefore, the Yankees are not going to win the game.
\item All cats make Frank sneeze, unless they are hairless. Some hairless cats are cuddly. Therefore, some cuddly things make Frank sneeze.
\end{earg}

\fi
